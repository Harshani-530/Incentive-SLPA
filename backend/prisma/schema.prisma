generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Employee {
  id             Int      @id @default(autoincrement())
  employeeNumber String   @unique
  employeeName   String
  jobWeight      String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  designation    String?

  @@map("employees")
}

model EmployeeDays {
  id             Int      @id @default(autoincrement())
  employeeNumber String
  noOfDays       Float
  month          DateTime
  createdAt      DateTime @default(now())

  @@unique([employeeNumber, month])
  @@map("employee_days")
}

model User {
  id                   Int               @id @default(autoincrement())
  username             String            @unique
  password             String
  name                 String?
  role                 String
  isActive             Boolean           @default(true)
  failedLoginAttempts  Int               @default(0)
  lockedUntil          DateTime?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  passwordHistory      PasswordHistory[]

  @@map("users")
}

model PasswordHistory {
  id           Int      @id @default(autoincrement())
  userId       Int
  passwordHash String
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_history")
}

model MonthlyReport {
  id                     Int       @id @default(autoincrement())
  month                  DateTime  @unique
  gateMovement           Float?
  vesselAmount           Float?
  status                 String    @default("in_progress")
  employeeDaysLockedAt   DateTime?
  employeeDaysLockedBy   String?
  adminFinishedAt        DateTime?
  adminFinishedBy        String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  @@map("monthly_reports")
}

model IncentiveHistory {
  employeeNumber  String
  employeeName    String
  designation     String?
  jobWeight       String
  noOfDays        Float
  oldRateAmount   Float
  newRateAmount   Float
  month           DateTime
  createdAt       DateTime  @default(now())
  
  @@id([month, employeeNumber])
  @@map("incentive_history")
}
